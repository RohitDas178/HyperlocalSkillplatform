# Skilloc Chatbox - Architecture & Flow Diagrams

## ğŸ—ï¸ System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        SKILLOC CHATBOX SYSTEM                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CLIENT BROWSER                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚   client.html    â”‚          â”‚   chatbox.html   â”‚            â”‚
â”‚  â”‚  (Login/Reg)     â”‚          â”‚   (Chat UI)      â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚           â”‚                             â”‚                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  public/js/chat.js                             â”‚           â”‚
â”‚  â”‚  (ChatApp Class - Application Logic)           â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚           â”‚                          â”‚                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚  localStorage     â”‚      â”‚  Socket.IO     â”‚               â”‚
â”‚  â”‚  - authToken      â”‚      â”‚  Connection    â”‚               â”‚
â”‚  â”‚  - userId         â”‚      â”‚  (Real-time)   â”‚               â”‚
â”‚  â”‚  - userType       â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚                        â”‚
â”‚                                     â”‚                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  chatbox.css                                           â”‚ â”‚
â”‚  â”‚  (Styling - Gradients, Animations, Responsive)        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                â”‚
              â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
              â”‚ Socket.IO â”‚   â”‚  REST API  â”‚
              â”‚ (port80)  â”‚   â”‚ (HTTPS)    â”‚
              â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                    â”‚               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      NODE.JS SERVER                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Express.js App (server.js)                               â”‚  â”‚
â”‚  â”‚  - HTTP Server on port 3000                               â”‚  â”‚
â”‚  â”‚  - CORS Enabled                                           â”‚  â”‚
â”‚  â”‚  - Static file serving                                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚               â”‚                  â”‚          â”‚                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”  â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  Socket.IO Server â”‚  â”‚  Express   â”‚  â”‚  JWT Verify â”‚        â”‚
â”‚  â”‚  - authenticate   â”‚  â”‚  Routes    â”‚  â”‚  Middleware â”‚        â”‚
â”‚  â”‚  - message relay  â”‚  â”‚  - /auth   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚  â”‚  - user tracking  â”‚  â”‚  - /api/*  â”‚                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜                         â”‚
â”‚               â”‚                  â”‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Authentication & Business Logic                       â”‚    â”‚
â”‚  â”‚  - JWT Token Generation                               â”‚    â”‚
â”‚  â”‚  - Password Hashing (Bcrypt)                          â”‚    â”‚
â”‚  â”‚  - Conversation Management                            â”‚    â”‚
â”‚  â”‚  - Worker/Client Lookup                               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                   â”‚                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Storage Layer (storage.js)                           â”‚    â”‚
â”‚  â”‚  - File I/O Operations                               â”‚    â”‚
â”‚  â”‚  - JSON Data Reading/Writing                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                   â”‚                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
â”‚   /data        â”‚   â”‚   Local Files  â”‚
â”‚                â”‚   â”‚                â”‚
â”‚ messages.json  â”‚   â”‚ (Config, etc)  â”‚
â”‚ workers.json   â”‚   â”‚                â”‚
â”‚ clients.json   â”‚   â”‚                â”‚
â”‚ worker.db      â”‚   â”‚                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Authentication Flow

```
                    CLIENT SIDE                          SERVER SIDE
                    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

User visits client.html
        â”‚
        â”œâ”€ Check localStorage for:
        â”‚  â€¢ authToken
        â”‚  â€¢ userId
        â”‚  â€¢ userType
        â”‚
        â”œâ”€ If found & valid â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                                          â”‚
        â”‚                                              Redirect to
        â”‚                                              chatbox.html
        â”‚
        â”œâ”€ If not found or invalid
        â”‚
        â”œâ”€ Show Login Form
        â”‚
        â””â”€ User enters credentials
                â”‚
                â”œâ”€ POST /api/auth/login
                â”‚  {
                â”‚    email: "user@example.com"
                â”‚    password: "password123"
                â”‚    type: "client"
                â”‚  }
                â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                                          â”‚
                                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                    â”‚
                                                    â”œâ”€ Hash input password
                                                    â”‚
                                                    â”œâ”€ Find client in clients.json
                                                    â”‚
                                                    â”œâ”€ Compare with bcrypt
                                                    â”‚
                                                    â”œâ”€ If match:
                                                    â”‚  â€¢ Generate JWT token
                                                    â”‚  â€¢ Return token + user info
                                                    â”‚
                                                    â””â”€ If no match:
                                                       Return 401 error
                â”‚
                â”‚ Response:
                â”‚ {
                â”‚   success: true
                â”‚   token: "eyJhbGc..."
                â”‚   user: { id, email, type }
                â”‚ }
                â”‚
                â”œâ”€ Store in localStorage:
                â”‚  â€¢ localStorage.authToken = token
                â”‚  â€¢ localStorage.userId = id
                â”‚  â€¢ localStorage.userType = "client"
                â”‚
                â””â”€ Redirect to chatbox.html


        Chatbox.html loads
                â”‚
                â”œâ”€ Read token from localStorage
                â”‚
                â”œâ”€ Initialize Socket.IO connection
                â”‚
                â””â”€ socket.emit('authenticate', {token: "eyJhbGc..."})
                     â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                                     â”‚
                                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                                         â”œâ”€ jwt.verify(token)
                                         â”‚
                                         â”œâ”€ If valid:
                                         â”‚  â€¢ Store user in socket.user
                                         â”‚  â€¢ Track socket ID for user
                                         â”‚  â€¢ Emit 'authenticated' back
                                         â”‚
                                         â””â”€ If invalid:
                                            Emit 'unauthorized' error
                â”‚
                â”œâ”€ socket.on('authenticated')
                â”‚
                â””â”€ App ready to use!
```

---

## ğŸ’¬ Message Flow

```
                    CLIENT (Sender)              NETWORK              SERVER              CLIENT (Receiver)
                    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”€â”€â”€â”€â”€â”€â”€              â”€â”€â”€â”€â”€â”€              â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

User types message
"Hello, are you available?"
        â”‚
        â”œâ”€ Click Send
        â”‚
        â”œâ”€ Validate:
        â”‚  â€¢ Message not empty
        â”‚  â€¢ Worker selected
        â”‚
        â”œâ”€ If Socket.IO connected:
        â”‚  â”‚
        â”‚  â””â”€ socket.emit('private_message', {
        â”‚       toId: worker_id
        â”‚       text: "Hello, are you available?"
        â”‚     })
        â”‚       â”‚
        â”‚       â”‚  Socket.IO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚       â”‚                                                   â”‚
        â”‚       â”‚                                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚       â”‚                                         â”‚
        â”‚       â”‚                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚       â”‚                            â”‚ Server receives       â”‚
        â”‚       â”‚                            â”‚ 'private_message'     â”‚
        â”‚       â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚       â”‚                                         â”‚
        â”‚       â”‚                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚       â”‚                            â”‚ Validate sender has   â”‚
        â”‚       â”‚                            â”‚ socket.user token     â”‚
        â”‚       â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚       â”‚                                         â”‚
        â”‚       â”‚                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚       â”‚                            â”‚ Create message object â”‚
        â”‚       â”‚                            â”‚ with timestamp        â”‚
        â”‚       â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚       â”‚                                         â”‚
        â”‚       â”‚                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚       â”‚                            â”‚ Persist to            â”‚
        â”‚       â”‚                            â”‚ data/messages.json    â”‚
        â”‚       â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚       â”‚                                         â”‚
        â”‚       â”‚                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚       â”‚                            â”‚ Find recipient's      â”‚
        â”‚       â”‚                            â”‚ socket(s) if online   â”‚
        â”‚       â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚       â”‚                                         â”‚
        â”‚       â”‚                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚       â”‚                            â”‚ If recipient online:  â”‚
        â”‚       â”‚                            â”‚ io.to(socket).emit    â”‚
        â”‚       â”‚                            â”‚ ('message', msg)      â”‚
        â”‚       â”‚                            â”‚                       â”‚
        â”‚       â”‚                            â”‚ If recipient offline: â”‚
        â”‚       â”‚                            â”‚ Message stored only   â”‚
        â”‚       â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚       â”‚                                         â”‚
        â”‚       â”‚â—„â”€â”€â”€â”€ Socket.IO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚       â”‚
        â”‚ â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ â”‚ Emit back to sender:          â”‚
        â”‚ â”‚ socket.emit('message', msg)   â”‚
        â”‚ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚       â”‚                                     â”‚
        â”‚       â”‚                                 Socket.IO
        â”‚       â”‚                                  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚       â”‚                                           â”‚
        â”‚       â”œâ”€ Display message immediately             â”‚
        â”‚       â”‚ â€¢ Append to chat window                   â”‚
        â”‚       â”‚ â€¢ Style as "sent" (gradient)              â”‚
        â”‚       â”‚ â€¢ Add timestamp                           â”‚
        â”‚       â”‚ â€¢ Show in chat history                    â”‚
        â”‚       â”‚ â€¢ Scroll to bottom                        â”‚
        â”‚       â”‚                                           â”‚
        â”‚       â”œâ”€ Clear input field                    â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚       â”‚                                       â”‚ If recipient   â”‚
        â”‚       â””â”€ Re-enable send button               â”‚ online:        â”‚
        â”‚                                               â”‚ Receive msg    â”‚
        â”‚                                               â”‚ in real-time   â”‚
        â”‚                                               â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                                                   â”‚
        â”‚                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
        â”‚                                    â”‚ socket.on         â”‚
        â”‚                                    â”‚ ('message', msg)  â”‚
        â”‚                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
        â”‚                                                   â”‚
        â”‚                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                    â”‚ Add to message queue   â”‚
        â”‚                                    â”‚ Display immediately    â”‚
        â”‚                                    â”‚ Style as "received"    â”‚
        â”‚                                    â”‚ (dark background)      â”‚
        â”‚                                    â”‚ Scroll to bottom       â”‚
        â”‚                                    â”‚ Play notification      â”‚
        â”‚                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”œâ”€ Else (Socket.IO disconnected):
        â”‚  â”‚
        â”‚  â””â”€ Fallback to REST API:
        â”‚       POST /api/messages
        â”‚       Headers: Authorization: Bearer token
        â”‚       Body: { fromId, toId, text }
        â”‚         â”‚
        â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                          â”‚
        â”‚                                (Same flow as above,
        â”‚                                 but synchronous)
        â”‚                                          â”‚
        â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚         â”‚
        â”‚         â””â”€ Display message on response
        â”‚
        â””â”€ Message successfully sent!

(When recipient logs in later or reconnects, messages are loaded from database)
```

---

## ğŸ”Œ Socket.IO Connection Lifecycle

```
Browser Load
    â”‚
    â”œâ”€ Initialize Socket.IO client
    â”‚  io() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                 â”‚
    â”‚                                    TCP Connection
    â”‚                                    HTTP Upgrade
    â”‚                                    WebSocket Handshake
    â”‚                                                 â”‚
    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”œâ”€ socket.on('connect')
    â”‚  Socket connected to server
    â”‚
    â”œâ”€ Emit authenticate event
    â”‚  socket.emit('authenticate', {token})
    â”‚       â”‚
    â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                   â”‚
    â”‚                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚                               â”‚
    â”‚                    Server verifies JWT
    â”‚                               â”‚
    â”‚                               â”œâ”€ If valid:
    â”‚                               â”‚  io.on('authenticated')
    â”‚                               â”‚
    â”‚                               â””â”€ If invalid:
    â”‚                                  io.emit('unauthorized')
    â”‚
    â”œâ”€ socket.on('authenticated')
    â”‚  Ready to send/receive messages
    â”‚
    â”œâ”€ Listen for 'message' event (incoming)
    â”‚  socket.on('message', handler)
    â”‚
    â”œâ”€ Can emit 'private_message' (outgoing)
    â”‚  socket.emit('private_message', {toId, text})
    â”‚
    â”œâ”€ socket.on('disconnect')
    â”‚  Cleaned up on server side
    â”‚
    â””â”€ On reconnect:
       Repeat authentication â†’ Ready again

(Automatic reconnection with exponential backoff)
```

---

## ğŸ“Š Worker List Display Flow

```
chatbox.html loads
        â”‚
        â”œâ”€ ChatApp constructor runs
        â”‚
        â”œâ”€ loadWorkers() called
        â”‚
        â”œâ”€ Fetch GET /api/workerdb
        â”‚       â”‚
        â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                              â”‚
        â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                         â”‚ Server reads     â”‚
        â”‚                         â”‚ worker.db file   â”‚
        â”‚                         â”‚                  â”‚
        â”‚                         â”‚ Returns array of â”‚
        â”‚                         â”‚ online workers   â”‚
        â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”œâ”€ Response arrives: { workers: [...] }
        â”‚
        â”œâ”€ Store in this.workers array
        â”‚
        â”œâ”€ displayWorkers(workers)
        â”‚
        â”œâ”€ Create HTML for each worker:
        â”‚  <div class="worker-item">
        â”‚    <avatar>
        â”‚    <name>
        â”‚    <profession>
        â”‚    <status-dot>
        â”‚  </div>
        â”‚
        â”œâ”€ Inject into DOM:
        â”‚  #workerList.innerHTML = html
        â”‚
        â”œâ”€ Attach click listeners
        â”‚
        â””â”€ Search/filter functionality ready

User searches: "Rohit"
        â”‚
        â”œâ”€ Input event fires
        â”‚
        â”œâ”€ filterWorkers() called
        â”‚
        â”œâ”€ Get search term: "rohit"
        â”‚ Get category filter: "" (all)
        â”‚
        â”œâ”€ Filter this.workers array:
        â”‚  workers.filter(w =>
        â”‚    w.firstName.includes("rohit") ||
        â”‚    w.lastName.includes("rohit") ||
        â”‚    w.profession.includes("rohit")
        â”‚  )
        â”‚
        â”œâ”€ displayWorkers(filtered)
        â”‚
        â””â”€ UI updates with results

User clicks worker
        â”‚
        â”œâ”€ Click event fires
        â”‚
        â”œâ”€ selectWorker(workerId) called
        â”‚
        â”œâ”€ Update UI:
        â”‚  â€¢ Hide "no chat selected"
        â”‚  â€¢ Show "chat active"
        â”‚  â€¢ Mark worker as active
        â”‚  â€¢ Show worker name/profession/avatar
        â”‚
        â”œâ”€ loadConversation(workerId)
        â”‚  Fetch GET /api/messages?clientId=X&workerId=Y
        â”‚       â”‚
        â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                      â”‚
        â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                    â”‚
        â”‚         Server filters messages.json
        â”‚         Returns matching messages
        â”‚                    â”‚
        â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”œâ”€ Store in this.messages Map
        â”‚
        â”œâ”€ displayMessages(convId)
        â”‚
        â”œâ”€ Render messages:
        â”‚  â€¢ Create message bubbles
        â”‚  â€¢ Style sent vs received
        â”‚  â€¢ Add timestamps
        â”‚  â€¢ Sort by time
        â”‚
        â”œâ”€ Inject into #messagesContainer
        â”‚
        â”œâ”€ Scroll to bottom
        â”‚
        â””â”€ Focus on input field
           Ready to type!
```

---

## ğŸƒ Real-time vs Fallback Flow

```
Send Message

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ isConnected && socket?               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
         â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
         â”‚          â”‚
         â”‚ YES      â”‚ NO
         â”‚          â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”   â”Œâ”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Socket  â”‚   â”‚ REST API   â”‚
    â”‚  .IO    â”‚   â”‚ Fallback   â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚         â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”   â”Œâ”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Emit    â”‚   â”‚ POST       â”‚
    â”‚ private â”‚   â”‚ /api/      â”‚
    â”‚ message â”‚   â”‚ messages   â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚         â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚ Server processes     â”‚
    â”‚ - Validate sender    â”‚
    â”‚ - Create message     â”‚
    â”‚ - Persist to JSON    â”‚
    â”‚ - Route to recipient â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Recipient gets  â”‚
    â”‚ message via     â”‚
    â”‚ - Real-time if  â”‚
    â”‚   online        â”‚
    â”‚ - On next load  â”‚
    â”‚   if offline    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Real-time advantages:
âœ“ Instant delivery if online
âœ“ Both-way communication
âœ“ No HTTP overhead
âœ“ Automatic reconnection

REST API advantages:
âœ“ Works if WebSocket unavailable
âœ“ Standard HTTP infrastructure
âœ“ Better with proxies/firewalls
âœ“ Easier to debug
```

---

## ğŸ“ Message Storage

```
Client sends message

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Message Object Created:                â”‚
â”‚ {                                      â”‚
â”‚   from: "client_id_1234567890",       â”‚
â”‚   to: "worker_id_9876543210",         â”‚
â”‚   text: "Hello, are you available?",  â”‚
â”‚   ts: "2025-12-30T10:35:45.123Z",    â”‚
â”‚   conversationId: "conv:..."          â”‚
â”‚ }                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”œâ”€ Emit via Socket.IO
                     â”‚        â”‚
                     â”‚        â””â”€ Server receives
                     â”‚
                     â”œâ”€ Server persists to:
                     â”‚  data/messages.json
                     â”‚  {
                     â”‚    "from": "...",
                     â”‚    "to": "...",
                     â”‚    "text": "...",
                     â”‚    "ts": "...",
                     â”‚    "conversationId": "..."
                     â”‚  }
                     â”‚
                     â”œâ”€ Message ID implicitly:
                     â”‚  Index in array
                     â”‚
                     â””â”€ Permanent storage âœ“
                        (until manually deleted)

Message Retrieval:

Client needs history
        â”‚
        â”œâ”€ Fetch /api/messages?clientId=X&workerId=Y
        â”‚
        â”œâ”€ Server loads messages.json
        â”‚
        â”œâ”€ Filter by:
        â”‚  conversationId = "conv:[X]_[Y]"
        â”‚
        â”œâ”€ Return matching messages
        â”‚  Sorted by timestamp
        â”‚
        â””â”€ Client displays in order

Conversation ID format:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ conv:[min_id]_[max_id]                 â”‚
â”‚                                        â”‚
â”‚ Example:                               â”‚
â”‚ Client: 1234567890                     â”‚
â”‚ Worker: 9876543210                     â”‚
â”‚                                        â”‚
â”‚ Conv ID: conv:1234567890_9876543210   â”‚
â”‚ (Always sorted same way)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Diagrams Version**: 1.0  
**Created**: December 30, 2025
